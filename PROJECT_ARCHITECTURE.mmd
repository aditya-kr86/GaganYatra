%% Project architecture: Models -> Schemas -> Routes -> Services
%% File: PROJECT_ARCHITECTURE.mmd
%% Render with https://mermaid.live or VS Code Mermaid preview

flowchart TB
  %% subgraphs for clarity
  subgraph MODELS[Models (app/models)]
    M_Flight["Flight\napp/models/flight.py"]
    M_Booking["Booking\napp/models/booking.py"]
    M_Ticket["Ticket\napp/models/ticket.py"]
    M_Seat["Seat\napp/models/seat.py"]
    M_Payment["Payment\napp/models/payment.py"]
    M_User["User\napp/models/user.py"]
    M_Airport["Airport\napp/models/airport.py"]
    M_Airline["Airline\napp/models/airline.py"]
    M_Aircraft["Aircraft\napp/models/aircraft.py"]
  end

  subgraph SCHEMAS[Schemas (app/schemas)]
    S_Flight["FlightSchema\napp/schemas/flight_schema.py"]
    S_Booking["BookingSchema\napp/schemas/booking_schema.py"]
    S_Ticket["TicketSchema\napp/schemas/ticket_schema.py"]
    S_Seat["SeatSchema\napp/schemas/seat_schema.py"]
    S_Payment["PaymentSchema\napp/schemas/payment_schema.py"]
    S_User["UserSchema\napp/schemas/user_schema.py"]
    S_Airport["AirportSchema\napp/schemas/airport_schema.py"]
    S_Airline["AirlineSchema\napp/schemas/airline_schema.py"]
    S_Aircraft["AircraftSchema\napp/schemas/aircraft_schema.py"]
  end

  subgraph ROUTES[Routes (app/routes) â€” mounted in backend/main.py]
    R_Flight["/flights\napp/routes/flight_routes.py"]
    R_Booking["/bookings\napp/routes/booking_routes.py"]
    R_Payment["/payments\napp/routes/payment_routes.py"]
    R_Airport["/airports\napp/routes/airport_routes.py"]
    R_Airline["/airlines\napp/routes/airline_routes.py"]
    R_Aircraft["/aircrafts\napp/routes/aircraft_routes.py"]
    R_User["/users\napp/routes/user_routes.py"]
    R_Seat["/seats\napp/routes/seat_routes.py"]
    R_Ticket["/tickets\napp/routes/ticket_routes.py"]
  end

  subgraph SERVICES[Services & Utilities (app/services, app/utils)]
    SV_Flight["flight_service.py\n(app/services/flight_service.py)"]
    SV_UTILS["utils (pnr/pdf/etc)\n(app/utils/*)"]
  end

  %% Model -> Schema (data shape mapping)
  M_Flight --> S_Flight
  M_Booking --> S_Booking
  M_Ticket --> S_Ticket
  M_Seat --> S_Seat
  M_Payment --> S_Payment
  M_User --> S_User
  M_Airport --> S_Airport
  M_Airline --> S_Airline
  M_Aircraft --> S_Aircraft

  %% Routes use Schemas for validation and responses
  R_Flight -->|uses| S_Flight
  R_Booking -->|uses| S_Booking
  R_Payment -->|uses| S_Payment
  R_Airport -->|uses| S_Airport
  R_Airline -->|uses| S_Airline
  R_Aircraft -->|uses| S_Aircraft
  R_User -->|uses| S_User
  R_Seat -->|uses| S_Seat
  R_Ticket -->|uses| S_Ticket

  %% Routes call Services and Services operate on Models
  R_Flight -->|calls| SV_Flight
  R_Booking -->|calls| SV_Flight
  R_Payment -->|calls| SV_Flight
  SV_Flight -->|reads/writes| M_Flight
  SV_Flight -->|creates| M_Seat
  SV_Flight -->|creates| M_Booking
  SV_Flight -->|creates| M_Ticket
  SV_Flight -->|creates| M_Payment
  SV_Flight -->|uses utils| SV_UTILS

  %% Additional relations between models (high-level)
  M_Flight -->|has seats| M_Seat
  M_Flight -->|has tickets| M_Ticket
  M_Booking -->|owns tickets| M_Ticket
  M_Booking -->|has payment| M_Payment
  M_User -->|creates| M_Booking
  M_Airline -->|operates| M_Flight
  M_Aircraft -->|is used by| M_Flight
  M_Airport -->|departures/arrivals| M_Flight

  %% Legend
  subgraph LEGEND[Legend]
    L1([Model])
    L2([Schema])
    L3([Route])
    L4([Service/Util])
  end

  style MODELS fill:#f9f9ff,stroke:#333,stroke-width:1px
  style SCHEMAS fill:#f3fff3,stroke:#333,stroke-width:1px
  style ROUTES fill:#fff7e6,stroke:#333,stroke-width:1px
  style SERVICES fill:#fff0f6,stroke:#333,stroke-width:1px

%% Notes
%% - Routes are mounted in backend/main.py with prefixes shown in the Route nodes.
%% - Services encapsulate business logic: search, pricing, booking, payments, and seat reconciliation.
%% - Schemas are Pydantic request/response models used by routes and OpenAPI.
%% How to render:
%% - Copy this file into https://mermaid.live and paste code to preview & export.
%% - Or open in VS Code with a Mermaid preview extension and render inline in Markdown.
